name: execute
description: Execute a remote script
inputs:
  host:
    description: 'SSH hostname'
    required: true
  port:
    description: 'SSH port'
    required: true
    default: '22'
  user:
    description: 'SSH user'
    required: true
  target_path:
    description: 'path to run command from'
    required: true
  commands:
    description: 'commands to run'
    required: true
outputs:
  stdout:
    description: "Standard output"
    value: ${{ steps.execute.outputs.stdout }}
runs:
  using: composite
  steps:
    - name: Execute
      id: execute
      shell: bash
      run: |
        sshout=$(ssh ssh://${{ inputs.user }}@${{ inputs.host }}:${{ inputs.port }} "cd ${{ inputs.target_path }} && ${{ inputs.commands }}")
        EOF=$(dd if=/dev/urandom bs=15 count=1 status=none | base64)
        echo "stdout<<$EOF" >> $GITHUB_OUTPUT
        echo "$sshout" >> $GITHUB_OUTPUT
        echo "$EOF" >> $GITHUB_OUTPUT
